- 높은 처리량
- 빠른 응답속도
- 안정성

# 왜 이런 안정적이고 높은 처리량을 갖게 되나? 
---
### 분산 시스템

분산 시스템은 여러 컴퓨터가 네트워크 상에서 연결된 그룹이다. 그렇기에 단일 시스템에서 갖지 못한 높은 성능을 보인다. 그리고 하나의 서버에서 장애가 발생하더라도 다른 노드에서 처리하므로 장애 대응이 탁월하여 안정적인다. 부하가 높다면 브로커를 추가하는 방식으로 확장이 가능하다.

### [[페이지 캐시 (pagecache)]]

카프카가 높은 처리량을 얻기 위해서 몇가지 기능을 추가했는데 그중 대표적인 것이 페이지 캐시 이용이다. 운영체제는 성능을높이기 위해 꾸준히 진화하고 개선되고 있는데, 특히 페이지 캐시의 활용이 대표적이다. 카프카 역시 OS의 페이지 캐시를 활용하는 방식으로 설계되어 있다. 
 

- 이벤트 버스는 서빙 레이어와 스토리지 레이어가 분리되어 있어 추가적인 홉이 필요하지만 카프카 는 하나의 프로세스에서 스토리지와 요청을 모두 처리한다는 차이가 있었습니다.

- 이 벤트 버스는 fsync()를 하는 동안 블로킹을 하는 반면, 카프카는 OS에 의존해 백그라운드 로 fsync()를 처리하고 제로카피zero-copy를 사용했습니다.

- 이벤트 버스를 운영하 려면 더 많은 하드웨어를 필요로 하는 반면에 카프카는 이벤트 버스만큼의 많은 하드웨어가 필요치 않았습니다

### 배치 전송 처리

![[Pasted image 20231022231429.png]]

- 최종 승객이 도착하 시점은 비슷할 것이다. 
- 실시간 그룹은 보다 배치그룹은 더 적은 기차 수를 이용했기에 효율적인 부분이 있다. 
- 온라인 상품 구매 프로세스에서 상품 재고 수량 업데이트 작업은 지연없이 실시간으로 처리해하지만, 구매 로그를 저장소로 보내는 작업은 이미 로그가 서버에 기록되어 있으므로 **실시간 처리보다는 배치 처리가 효율적이다.**

### 압축 전송

- 메시지 전송 시 높은 압축 전송을 사용하는 것을 권장한다.
- 카프카 지원 압축 타입은 gzip, snappy, lz4, zstd
	- 압축만으로 네트워크 대역폭이나 회선비용을 줄일 수 있다. 
	- 높은 압축률 => gzip이나 zstd 권장
	- 빠른 응답속도 => lz4, snappy
	- 메시지의 형식이나 크기에 따라 또 다른 결과를 나타낼 수 있으니 실제로 메시지를 전송해보면서 압축 타입별로 직접 테스트해봐라

### 토픽, 파티션, 오프셋

- 토픽은 메시지를 묶는 그룹화를 의미
- 토픽은 병렬 처리 및 높은 처리량을 위해 여러 **파티션**이라는 단위로 나눈다. 
- 이 파티션의 메시지가 저장되는 위치를 **오프셋**이라고 부른다. 
	- 각 파티션에서의 오프셋은 고유한 숫자. 
	- 메시지 순서 보장
	- 컨슈머에서는 마지막까지 읽은 위치를 알 수 있음


### 고가용성 보장
카프카는 분산 시스템이기 때문에 하나의 서버나 노드가 다운되어도 다른 서버가 대신해 안정적인 운영이 가능하다. 이러한 고가용성을 보장하기 위해서 [[리플리케이션 (replication)]] 기능을 제공한다. 


### 주키퍼의 의존성
하지만 주키퍼 성능의 한계가 드러나기 시작했고 주키퍼의 한계에서 벗어나고자 의존성을 제거한 카프카 버전이 릴리스되었다. 



